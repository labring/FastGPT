# FastGPT å¼€å‘æ—¥å¿— - 2025å¹´12æœˆ8æ—¥

## ğŸ“‹ ä»Šæ—¥å·¥ä½œæ€»ç»“

### ä¸€ã€APIè°ƒç”¨é—®é¢˜æ’æŸ¥ä¸è§£å†³

#### 1. API2D 402 Payment Required é”™è¯¯
**é—®é¢˜æè¿°**ï¼š
- åœ¨PDFå‘é‡åŒ–è¿‡ç¨‹ä¸­é‡åˆ° `402 Payment Required` é”™è¯¯
- API2DæœåŠ¡ï¼ˆoa.api2d.netï¼‰è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œæ— æ³•ç»§ç»­è°ƒç”¨embeddingæ¥å£

**å½±å“èŒƒå›´**ï¼š
- æ‰€æœ‰PDFæ–‡æ¡£çš„å‘é‡åŒ–å¤„ç†è¢«é˜»æ­¢
- æ•°æ®é›†è®­ç»ƒé˜Ÿåˆ—å †ç§¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- éœ€è¦ä¸ºAPI2Dè´¦æˆ·å……å€¼
- æˆ–åˆ‡æ¢åˆ°å…¶ä»–embeddingæœåŠ¡æä¾›å•†

---

#### 2. ç¡…åŸºæµåŠ¨(SiliconFlow) 401 Unauthorized é”™è¯¯
**é—®é¢˜æè¿°**ï¼š
- å°è¯•ä½¿ç”¨å…è´¹çš„SiliconFlow APIä½œä¸ºAPI2Dæ›¿ä»£æ–¹æ¡ˆ
- é…ç½®ä¿¡æ¯ï¼š
  ```
  APIåœ°å€: https://api.siliconflow.cn/v1
  æ¨¡å‹: BAAI/bge-large-zh-v1.5
  API Key: sk-liwmvx...
  ```
- ä½¿ç”¨PowerShellç›´æ¥æµ‹è¯•APIæˆåŠŸï¼ˆè¿”å›1024ç»´å‘é‡ï¼‰
- ä½†FastGPTé›†æˆåæŒç»­è¿”å› `401 Unauthorized` é”™è¯¯

**æ ¹æœ¬åŸå› **ï¼š
- FastGPTçš„embedding APIè°ƒç”¨æ ¼å¼ä¸SiliconFlowä¸å®Œå…¨å…¼å®¹
- å°½ç®¡SiliconFlowå£°ç§°å…¼å®¹OpenAIæ ¼å¼ï¼Œä½†æŸäº›è¯·æ±‚å‚æ•°æˆ–è®¤è¯æ–¹å¼å­˜åœ¨å·®å¼‚
- FastGPTå†…éƒ¨æœ‰é¢å¤–çš„APIè°ƒç”¨é€»è¾‘ï¼Œä¸æ ‡å‡†OpenAIæ ¼å¼æœ‰æ‰€ä¸åŒ

**æµ‹è¯•ç»“æœ**ï¼š
```powershell
# ç‹¬ç«‹æµ‹è¯•æˆåŠŸ
$headers = @{
    'Authorization' = 'Bearer sk-liwmvx...'
    'Content-Type' = 'application/json'
}
$body = @{
    model = 'BAAI/bge-large-zh-v1.5'
    input = 'æµ‹è¯•æ–‡æœ¬'
} | ConvertTo-Json

curl -Method POST -Uri 'https://api.siliconflow.cn/v1/embeddings' `
     -Headers $headers -Body $body
# è¿”å›: 1024ç»´å‘é‡ï¼ŒæˆåŠŸ
```

**ç»“è®º**ï¼š
- SiliconFlow APIåœ¨ç‹¬ç«‹ç¯å¢ƒä¸‹å¯ç”¨
- FastGPTé›†æˆéœ€è¦ä»£ç å±‚é¢çš„é€‚é…å·¥ä½œ
- æš‚ä¸æ¨èä½œä¸ºå³æ’å³ç”¨çš„æ›¿ä»£æ–¹æ¡ˆ

---

#### 3. m3e æœ¬åœ°æ¨¡å‹ 403 Forbidden é”™è¯¯
**é—®é¢˜æè¿°**ï¼š
- å°è¯•ä½¿ç”¨æœ¬åœ°Dockeréƒ¨ç½²çš„m3e embeddingæ¨¡å‹
- é•œåƒä¿¡æ¯ï¼š
  ```
  é•œåƒ: registry.cn-hangzhou.aliyuncs.com/fastgpt/m3e:latest
  å¤§å°: 10.5GB
  ç«¯å£: 6008
  ```
- å¯åŠ¨å‘½ä»¤ï¼š
  ```bash
  docker run -d -p 6008:6008 --gpus all m3e-embedding
  ```

**é”™è¯¯ç°è±¡**ï¼š
- æ‰€æœ‰ `/v1/embeddings` è¯·æ±‚å‡è¿”å› `403 Forbidden`
- å®¹å™¨æ—¥å¿—æ˜¾ç¤ºé‡å¤çš„403é”™è¯¯è®°å½•

**æ ¹æœ¬åŸå› **ï¼š
- **å•†ä¸šä½¿ç”¨é™åˆ¶**ï¼šm3eæ¨¡å‹æœ‰å•†ä¸šä½¿ç”¨è®¸å¯é™åˆ¶
- è¯¥Dockeré•œåƒå¯èƒ½é…ç½®äº†è®¸å¯éªŒè¯æœºåˆ¶
- æœªç»æˆæƒçš„å•†ä¸šéƒ¨ç½²ä¼šè¢«æ‹’ç»æœåŠ¡

**æµ‹è¯•ç»“æœ**ï¼š
```bash
# å®¹å™¨è¿è¡Œæ­£å¸¸
docker ps | grep m3e
# ç»“æœ: å®¹å™¨çŠ¶æ€ Up

# APIè¯·æ±‚å¤±è´¥
curl -X POST http://localhost:6008/v1/embeddings \
     -H "Content-Type: application/json" \
     -d '{"input": "æµ‹è¯•", "model": "m3e"}'
# è¿”å›: 403 Forbidden
```

**ç»“è®º**ï¼š
- m3eæ¨¡å‹ä¸é€‚åˆä½œä¸ºå…è´¹æ›¿ä»£æ–¹æ¡ˆ
- éœ€è¦è´­ä¹°å•†ä¸šè®¸å¯æˆ–å¯»æ‰¾å…¶ä»–å¼€æºæ¨¡å‹

---

### äºŒã€å‘é‡é˜Ÿåˆ—é—®é¢˜ä¸æ•°æ®æ¸…ç†

#### é—®é¢˜å‘ç°
**ç°è±¡**ï¼š
- ç”¨æˆ·ä»å‰ç«¯åˆ é™¤äº†æ•°æ®é›†å’Œæ–‡ä»¶
- ä½†åå°ä»åœ¨æŒç»­è°ƒç”¨embedding API
- å¯¼è‡´API creditsè¢«å¿«é€Ÿæ¶ˆè€—

**æ ¹æœ¬åŸå› **ï¼š
- FastGPTçš„å‘é‡å¤„ç†é˜Ÿåˆ—æ˜¯**æŒä¹…åŒ–**çš„
- ä»»åŠ¡å­˜å‚¨åœ¨MongoDBçš„ `dataset_trainings` é›†åˆä¸­
- Redisä¸­ä¹Ÿä¿å­˜äº†å¾…å¤„ç†çš„é˜Ÿåˆ—ä¿¡æ¯
- å‰ç«¯åˆ é™¤æ“ä½œ**åªåˆ é™¤äº†æ–‡ä»¶è®°å½•**ï¼Œæœªæ¸…é™¤å¤„ç†é˜Ÿåˆ—

**æ•°æ®è§„æ¨¡**ï¼š
- MongoDBä¸­å‘ç° **4,709** æ¡å¾…å¤„ç†ä»»åŠ¡
- å³ä½¿åœæ­¢FastGPTæœåŠ¡ï¼Œé‡å¯åä»ä¼šç»§ç»­å¤„ç†

#### è§£å†³æ­¥éª¤

**1. åœæ­¢æ‰€æœ‰Nodeè¿›ç¨‹**
```powershell
Get-Process -Name "node" | Stop-Process -Force
```

**2. æ¸…ç©ºRedisé˜Ÿåˆ—**
```bash
docker exec redis redis-cli -a mypassword FLUSHDB
# è¿”å›: OK
```

**3. åˆ é™¤MongoDBè®­ç»ƒä»»åŠ¡**
```javascript
docker exec mongo mongosh -u username -p password --authenticationDatabase admin fastgpt --eval '
db.dataset_trainings.deleteMany({})
'
// ç»“æœ: { acknowledged: true, deletedCount: 4709 }
```

**4. éªŒè¯æ¸…ç†ç»“æœ**
```javascript
db.dataset_trainings.countDocuments()
// è¿”å›: 0
```

**é˜²èŒƒæªæ–½**ï¼š
- åœ¨é…ç½®æ–°çš„embedding APIä¹‹å‰ï¼Œä¸è¦å¯åŠ¨FastGPT
- ç¡®ä¿APIæœ‰è¶³å¤Ÿçš„é…é¢
- å®šæœŸæ£€æŸ¥MongoDBè®­ç»ƒé˜Ÿåˆ—
- è€ƒè™‘æ·»åŠ é˜Ÿåˆ—ç›‘æ§å’Œé™æµæœºåˆ¶

---

### ä¸‰ã€ç®¡ç†å‘˜ç³»ç»ŸåŠŸèƒ½å¢å¼º

#### 1. åç«¯APIæ–°å¢åŠŸèƒ½

**æ–°å¢æ¥å£**ï¼ˆUsersController.javaï¼‰ï¼š

##### (1) æå‡ç”¨æˆ·ä¸ºç®¡ç†å‘˜
```java
@PutMapping("/{userId}/promote")
public Result promoteToAdmin(@PathVariable Integer userId)
```
- **åŠŸèƒ½**ï¼šå°†æ™®é€šç”¨æˆ·ï¼ˆrole_id=1ï¼‰æå‡ä¸ºç®¡ç†å‘˜ï¼ˆrole_id=2ï¼‰
- **æƒé™**ï¼šä»…è¶…çº§ç®¡ç†å‘˜å¯æ“ä½œ
- **è¿”å›**ï¼šæˆåŠŸæˆ–å¤±è´¥æ¶ˆæ¯

##### (2) é™çº§ç®¡ç†å‘˜ä¸ºæ™®é€šç”¨æˆ·
```java
@PutMapping("/{userId}/demote")
public Result demoteAdmin(@PathVariable Integer userId)
```
- **åŠŸèƒ½**ï¼šå°†ç®¡ç†å‘˜é™çº§ä¸ºæ™®é€šç”¨æˆ·
- **ä¿æŠ¤æœºåˆ¶**ï¼šæ— æ³•é™çº§é»˜è®¤çš„ `admin` è´¦æˆ·
- **æƒé™**ï¼šä»…è¶…çº§ç®¡ç†å‘˜å¯æ“ä½œ

##### (3) åˆ›å»ºç®¡ç†å‘˜è´¦å·
```java
@PostMapping("/create-admin")
public Result createAdmin(@RequestBody CreateAdminRequest request)
```
- **è¯·æ±‚å‚æ•°**ï¼š
  ```json
  {
    "username": "newadmin",
    "email": "admin@example.com",
    "password": "password123"
  }
  ```
- **éªŒè¯**ï¼šå¯†ç é•¿åº¦â‰¥6ä½
- **åŠ å¯†**ï¼šä½¿ç”¨BCryptåŠ å¯†å¯†ç 
- **é»˜è®¤è§’è‰²**ï¼šrole_id=2ï¼ˆç®¡ç†å‘˜ï¼‰

##### (4) ä¿®æ”¹å¯†ç 
```java
@PutMapping("/{userId}/change-password")
public Result changePassword(@PathVariable Integer userId, 
                             @RequestBody PasswordChangeRequest request)
```
- **è¯·æ±‚å‚æ•°**ï¼š
  ```json
  {
    "oldPassword": "old123",
    "newPassword": "new123456"
  }
  ```
- **éªŒè¯æµç¨‹**ï¼š
  1. éªŒè¯æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆBCrypt.matchesï¼‰
  2. æ£€æŸ¥æ–°å¯†ç é•¿åº¦â‰¥6ä½
  3. åŠ å¯†æ–°å¯†ç å¹¶æ›´æ–°æ•°æ®åº“
- **å®‰å…¨æ€§**ï¼šå¿…é¡»éªŒè¯æ—§å¯†ç 

##### (5) é‡ç½®å¯†ç ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
```java
@PutMapping("/{userId}/reset-password")
public Result resetPassword(@PathVariable Integer userId,
                            @RequestBody PasswordResetRequest request)
```
- **è¯·æ±‚å‚æ•°**ï¼š
  ```json
  {
    "newPassword": "reset123456"
  }
  ```
- **æƒé™**ï¼šç®¡ç†å‘˜å¯é‡ç½®ä»»æ„ç”¨æˆ·å¯†ç 
- **ç‰¹ç‚¹**ï¼šæ— éœ€æ—§å¯†ç éªŒè¯

---

#### 2. æ ¸å¿ƒBugä¿®å¤

##### Bug #1: å‰åç«¯å­—æ®µæ˜ å°„ä¸ä¸€è‡´
**é—®é¢˜**ï¼š
- å‰ç«¯å‘é€JSONå­—æ®µï¼š`username`ï¼ˆå°å†™ï¼‰
- åç«¯å®ä½“ç±»å­—æ®µï¼š`userName`ï¼ˆé©¼å³°å‘½åï¼‰
- å¯¼è‡´åˆ›å»ºç®¡ç†å‘˜æ—¶æŠ¥é”™ï¼š`Column 'userName' cannot be null`

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºDTOç±»è¿›è¡Œå­—æ®µæ˜ å°„ï¼š
```java
public static class CreateAdminRequest {
    private String username;  // å‰ç«¯å­—æ®µ
    private String email;
    private String password;
    
    // getters and setters
}

// Controllerä¸­
@PostMapping("/create-admin")
public Result createAdmin(@RequestBody CreateAdminRequest request) {
    Users newAdmin = userService.createAdmin(
        request.getUsername(),  // è½¬æ¢ä¸ºuserName
        request.getEmail(),
        request.getPassword()
    );
}
```

##### Bug #2: å‰ç«¯å“åº”ç åˆ¤æ–­é”™è¯¯
**é—®é¢˜**ï¼š
- åç«¯æˆåŠŸè¿”å›ï¼š`{"code": 1, "msg": "success"}`
- å‰ç«¯åˆ¤æ–­é€»è¾‘ï¼š`if (result.code === 0)` âŒ
- å¯¼è‡´æˆåŠŸæ“ä½œè¢«åˆ¤å®šä¸ºå¤±è´¥

**å½±å“èŒƒå›´**ï¼š
- createAdmin å‡½æ•°
- promoteToAdmin å‡½æ•°
- demoteAdmin å‡½æ•°
- loadAdminUsers å‡½æ•°

**ä¿®å¤**ï¼š
```javascript
// ä¿®æ”¹å‰
if (result.code === 0) {
    alert('æ“ä½œæˆåŠŸ');
}

// ä¿®æ”¹å
if (result.code === 1) {
    alert('æ“ä½œæˆåŠŸ');
}
```

##### Bug #3: SQL UPDATEè¯­å¥ç¼ºå°‘å…³é”®å­—æ®µ âš ï¸ **Critical**
**é—®é¢˜**ï¼š
- `UserMapper.xml` ä¸­çš„ `updateUser` SQLç¼ºå°‘å­—æ®µæ›´æ–°
- åŸå§‹SQLï¼š
  ```xml
  <update id="updateUser">
      UPDATE users 
      SET userName = #{userName}, 
          email = #{email}, 
          update_time = #{update_time}
      WHERE userId = #{userId}
  </update>
  ```
- **ç¼ºå°‘**ï¼š`password` å’Œ `role_id` å­—æ®µ

**ä¸¥é‡åæœ**ï¼š
1. âŒ ä¿®æ”¹å¯†ç åï¼Œæ•°æ®åº“å¯†ç æœªæ›´æ–°
2. âŒ æå‡/é™çº§ç®¡ç†å‘˜åï¼Œrole_idæœªæ”¹å˜
3. âŒ æ‰€æœ‰ä¾èµ–è¿™äº›å­—æ®µçš„åŠŸèƒ½å…¨éƒ¨å¤±æ•ˆ

**ä¿®å¤å**ï¼š
```xml
<update id="updateUser">
    UPDATE users 
    SET userName = #{userName}, 
        email = #{email},
        password = #{password},      -- âœ… æ–°å¢
        role_id = #{role_id},        -- âœ… æ–°å¢
        update_time = #{update_time}
    WHERE userId = #{userId}
</update>
```

**éªŒè¯æµ‹è¯•**ï¼š
```bash
# æµ‹è¯•ä¿®æ”¹å¯†ç 
curl -X PUT http://localhost:8080/api/users/2/change-password \
  -H "Content-Type: application/json" \
  -d '{"oldPassword":"123456", "newPassword":"newpass123"}'
# è¿”å›: {"code":1,"msg":"success"}

# éªŒè¯æ–°å¯†ç ç™»å½•
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin", "password":"newpass123"}'
# è¿”å›: {"code":1, "data":{"token":"..."}} âœ…
```

---

#### 3. å‰ç«¯ç®¡ç†ç•Œé¢æ–°å¢åŠŸèƒ½

**ä½ç½®**ï¼š`fastgpt-admin/src/pages/AdminDashboard.tsx`

##### (1) ä¿®æ”¹å¯†ç åŠŸèƒ½
**UIç»„ä»¶**ï¼š
- é¡µé¢å³ä¸Šè§’æ–°å¢ "ğŸ”‘ ä¿®æ”¹å¯†ç " æŒ‰é’®ï¼ˆè“è‰²æ¸å˜ï¼‰
- ç‚¹å‡»å¼¹å‡ºæ¨¡æ€æ¡†

**è¡¨å•å­—æ®µ**ï¼š
```typescript
const [changePasswordForm, setChangePasswordForm] = useState({
  oldPassword: '',      // æ—§å¯†ç ï¼ˆéªŒè¯èº«ä»½ï¼‰
  newPassword: '',      // æ–°å¯†ç 
  confirmPassword: ''   // ç¡®è®¤æ–°å¯†ç 
});
```

**éªŒè¯é€»è¾‘**ï¼š
1. æ£€æŸ¥æ‰€æœ‰å­—æ®µæ˜¯å¦å¡«å†™å®Œæ•´
2. éªŒè¯æ–°å¯†ç å’Œç¡®è®¤å¯†ç æ˜¯å¦ä¸€è‡´
3. æ£€æŸ¥æ–°å¯†ç é•¿åº¦â‰¥6ä½
4. è°ƒç”¨åç«¯APIéªŒè¯æ—§å¯†ç 

**APIè°ƒç”¨**ï¼š
```typescript
const response = await fetch(
  `${config.AUTH_API_URL}/users/${adminUser.userId}/change-password`,
  {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${adminToken}`
    },
    body: JSON.stringify({
      oldPassword: changePasswordForm.oldPassword,
      newPassword: changePasswordForm.newPassword
    })
  }
);
```

**å®‰å…¨æªæ–½**ï¼š
- ä¿®æ”¹æˆåŠŸåè‡ªåŠ¨é€€å‡ºç™»å½•
- å¼ºåˆ¶ç”¨æˆ·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•
- é˜²æ­¢ä¼šè¯åŠ«æŒ

**CSSæ ·å¼**ï¼š
```css
.change-password-btn {
  background: linear-gradient(135deg, #4299e1, #3182ce);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(66, 153, 225, 0.3);
  margin-right: 10px;
}

.change-password-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
}
```

##### (2) ç®¡ç†å‘˜ç®¡ç†æ ‡ç­¾é¡µ
**åŠŸèƒ½åˆ—è¡¨**ï¼š
- æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆrole_id=2ï¼‰
- æå‡æ™®é€šç”¨æˆ·ä¸ºç®¡ç†å‘˜
- é™çº§ç®¡ç†å‘˜ä¸ºæ™®é€šç”¨æˆ·
- åˆ›å»ºæ–°ç®¡ç†å‘˜è´¦å·
- æƒé™æ§åˆ¶ï¼ˆè¶…çº§ç®¡ç†å‘˜ä¸“å±ï¼‰

**æƒé™åˆ¤æ–­**ï¼š
```typescript
const isSuperAdmin = adminUser.username === 'admin' || 
                     adminUser.isSuperAdmin === true;
```

**æ“ä½œæµç¨‹ç¤ºä¾‹**ï¼š
```typescript
// æå‡ä¸ºç®¡ç†å‘˜
const promoteToAdmin = async (userId) => {
  const response = await fetch(
    `${config.AUTH_API_URL}/users/${userId}/promote`,
    { method: 'PUT' }
  );
  if (result.code === 1) {
    loadAdminUsers();  // åˆ·æ–°åˆ—è¡¨
  }
};
```

---

### å››ã€æŠ€æœ¯æ¶æ„æ€»ç»“

#### ç³»ç»Ÿç»„ä»¶
```
FastGPT å®Œæ•´æ¶æ„
â”œâ”€â”€ å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ projects/app (Next.js) - ä¸»åº”ç”¨ :3000
â”‚   â””â”€â”€ fastgpt-admin (React+Vite) - ç®¡ç†åå° :5173
â”œâ”€â”€ åç«¯æœåŠ¡
â”‚   â””â”€â”€ fastgpt-backend (Spring Boot) - APIæœåŠ¡ :8080
â”œâ”€â”€ æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ MongoDB - FastGPTä¸šåŠ¡æ•°æ® + è®­ç»ƒé˜Ÿåˆ—
â”‚   â”œâ”€â”€ PostgreSQL - ç”¨æˆ·è®¤è¯ + å¯¹è¯è®°å½•
â”‚   â””â”€â”€ Redis - ç¼“å­˜ + ä»»åŠ¡é˜Ÿåˆ—
â””â”€â”€ å¤–éƒ¨æœåŠ¡
    â”œâ”€â”€ Marker PDF (æœ¬åœ°GPU) :7231 - PDFè§£æ
    â”œâ”€â”€ API2D - EmbeddingæœåŠ¡ï¼ˆéœ€ä»˜è´¹ï¼‰
    â””â”€â”€ MinIO - å¯¹è±¡å­˜å‚¨
```

#### æ•°æ®åº“è®¾è®¡
**PostgreSQL - usersè¡¨**ï¼š
```sql
CREATE TABLE users (
  userId SERIAL PRIMARY KEY,
  userName VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100),
  password VARCHAR(255) NOT NULL,  -- BCryptåŠ å¯†
  role_id TINYINT DEFAULT 1,       -- 1=user, 2=admin
  create_time TIMESTAMP,
  update_time TIMESTAMP
);
```

**MongoDB - dataset_trainingsé›†åˆ**ï¼š
```javascript
{
  _id: ObjectId,
  datasetId: String,
  chunks: Array,
  status: String,  // pending, processing, completed, failed
  createTime: Date
}
```

#### è®¤è¯æµç¨‹
```
1. ç”¨æˆ·ç™»å½•
   POST /api/auth/login
   â†“
2. éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆBCryptï¼‰
   UserServiceImpl.login()
   â†“
3. ç”ŸæˆToken
   "jwt_token_" + userId
   â†“
4. è¿”å›ç”¨æˆ·ä¿¡æ¯
   { token, role, username, userId }
   â†“
5. å‰ç«¯å­˜å‚¨
   localStorage.setItem('admin-token', token)
   localStorage.setItem('admin-user', JSON.stringify(user))
```

---

### äº”ã€é—ç•™é—®é¢˜ä¸å»ºè®®

#### ğŸ”´ ç´§æ€¥é—®é¢˜
1. **EmbeddingæœåŠ¡æœªè§£å†³**
   - API2Déœ€è¦å……å€¼
   - å…è´¹æ›¿ä»£æ–¹æ¡ˆå‡å¤±è´¥
   - å»ºè®®ï¼šæ³¨å†ŒDeepSeek APIï¼ˆ0.0007å…ƒ/1K tokensï¼‰

2. **é»˜è®¤å¯†ç å®‰å…¨éšæ‚£**
   - adminè´¦æˆ·å¯†ç ï¼š123456
   - å»ºè®®ç«‹å³ä¿®æ”¹ä¸ºå¼ºå¯†ç 

#### ğŸŸ¡ æ”¹è¿›å»ºè®®
1. **Tokenè®¤è¯å‡çº§**
   - å½“å‰ä½¿ç”¨ç®€å•å­—ç¬¦ä¸²ï¼š`jwt_token_${userId}`
   - å»ºè®®ä½¿ç”¨çœŸå®JWTï¼ˆåŒ…å«è¿‡æœŸæ—¶é—´ã€ç­¾åéªŒè¯ï¼‰

2. **é˜Ÿåˆ—ç›‘æ§**
   - æ·»åŠ è®­ç»ƒé˜Ÿåˆ—çŠ¶æ€ç›‘æ§é¡µé¢
   - å®ç°é˜Ÿåˆ—æš‚åœ/æ¸…ç©ºåŠŸèƒ½
   - è®¾ç½®APIè°ƒç”¨é™æµ

3. **æ—¥å¿—ç³»ç»Ÿ**
   - è®°å½•æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œ
   - APIè°ƒç”¨æ—¥å¿—
   - é”™è¯¯è¿½è¸ª

4. **å¤‡ä»½æœºåˆ¶**
   - å®šæœŸå¤‡ä»½PostgreSQLå’ŒMongoDB
   - é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
   - æ•°æ®æ¢å¤æµ‹è¯•

#### ğŸŸ¢ åŠŸèƒ½å¢å¼º
1. **ç”¨æˆ·ç®¡ç†**
   - æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡åˆ é™¤ã€å¯¼å‡ºï¼‰
   - ç”¨æˆ·æ´»è·ƒåº¦ç»Ÿè®¡
   - ç™»å½•å†å²è®°å½•

2. **æƒé™ç»†åŒ–**
   - å¤šçº§æƒé™ç³»ç»Ÿ
   - è§’è‰²è‡ªå®šä¹‰
   - æ“ä½œå®¡è®¡æ—¥å¿—

3. **ç³»ç»Ÿç›‘æ§**
   - APIè°ƒç”¨ç»Ÿè®¡
   - èµ„æºä½¿ç”¨ç›‘æ§
   - å‘Šè­¦æœºåˆ¶

---

### å…­ã€å…³é”®ä»£ç ç‰‡æ®µ

#### å¯†ç åŠ å¯†ç¤ºä¾‹
```java
// UserServiceImpl.java
@Autowired
private BCryptPasswordEncoder passwordEncoder;

// æ³¨å†Œæ—¶åŠ å¯†
public Users register(String userName, String email, String password) {
    Users user = new Users();
    user.setPassword(passwordEncoder.encode(password));
    // ...
}

// ç™»å½•æ—¶éªŒè¯
public Users login(String userName, String password) {
    Users user = userMapper.findByUserName(userName);
    if (!passwordEncoder.matches(password, user.getPassword())) {
        throw new RuntimeException("å¯†ç é”™è¯¯");
    }
    return user;
}
```

#### å‰ç«¯APIé…ç½®
```typescript
// config.ts
const config = {
  AUTH_API_URL: 'http://localhost:8080/api',
  FASTGPT_URL: 'http://localhost:3000',
  ADMIN_URL: 'http://localhost:5173'
};
```

---

## ğŸ“Š å·¥ä½œæˆæœç»Ÿè®¡

- âœ… æ’æŸ¥3ä¸ªAPIé›†æˆé—®é¢˜
- âœ… æ¸…ç†4,709æ¡å†—ä½™è®­ç»ƒä»»åŠ¡
- âœ… æ–°å¢5ä¸ªç®¡ç†å‘˜APIæ¥å£
- âœ… ä¿®å¤3ä¸ªå…³é”®Bug
- âœ… å®ç°å®Œæ•´çš„å¯†ç ä¿®æ”¹åŠŸèƒ½
- âœ… ä¼˜åŒ–å‰ç«¯ç®¡ç†ç•Œé¢
- âœ… æ¸…ç†40+ä¸ªå†—ä½™æ–‡ä»¶
- âœ… ç¼–å†™å®Œæ•´æŠ€æœ¯æ–‡æ¡£

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **çŸ­æœŸ**ï¼ˆ1-3å¤©ï¼‰
   - [ ] è§£å†³embeddingæœåŠ¡ä»˜è´¹é—®é¢˜
   - [ ] ä¿®æ”¹adminé»˜è®¤å¯†ç 
   - [ ] å‡çº§JWTè®¤è¯æœºåˆ¶
   - [ ] æ·»åŠ æ“ä½œæ—¥å¿—åŠŸèƒ½

2. **ä¸­æœŸ**ï¼ˆ1-2å‘¨ï¼‰
   - [ ] å®ç°é˜Ÿåˆ—ç›‘æ§ç•Œé¢
   - [ ] æ·»åŠ æ‰¹é‡ç”¨æˆ·ç®¡ç†
   - [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½
   - [ ] æ€§èƒ½ä¼˜åŒ–

3. **é•¿æœŸ**ï¼ˆ1ä¸ªæœˆ+ï¼‰
   - [ ] å¤šçº§æƒé™ç³»ç»Ÿ
   - [ ] ç³»ç»Ÿç›‘æ§å¤§ç›˜
   - [ ] ç§»åŠ¨ç«¯é€‚é…
   - [ ] å›½é™…åŒ–æ”¯æŒ

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2025-12-08  
**ä½œè€…**: FastGPTå¼€å‘å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v1.0
