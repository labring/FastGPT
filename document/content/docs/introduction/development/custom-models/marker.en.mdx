---
title: Integrating Marker PDF Document Parsing
description: Use Marker to parse PDF documents with image extraction and layout recognition
---

## Background

PDF is a relatively complex file format. FastGPT's built-in PDF parser relies on the pdfjs library, which uses logical parsing and can't effectively handle complex PDFs. When parsing PDFs with images, tables, formulas, or other non-simple text content, you'll find the results lacking.

There are several methods for parsing PDFs on the market. One option is [Marker](https://github.com/VikParuchuri/marker), which uses the Surya model for vision-based parsing and can effectively extract images, tables, formulas, and other complex content.

In `FastGPT v4.9.0`, Community Edition users can add `systemEnv.customPdfParse` configuration to their `config.json` file to use Marker for PDF parsing. Commercial Edition users can fill in the form in the Admin dashboard. You'll need to pull the new Marker image as the API format has changed.

## Usage Guide

### 1. Install Marker

Refer to the [Marker installation tutorial](https://github.com/labring/FastGPT/tree/main/plugins/model/pdf-marker) to install the Marker model. The wrapped API is already adapted for FastGPT's custom parsing service.

Quick Docker installation:

```dockerfile
docker pull crpi-h3snc261q1dosroc.cn-hangzhou.personal.cr.aliyuncs.com/marker11/marker_images:v0.2
docker run --gpus all -itd -p 7231:7232 --name model_pdf_v2 -e PROCESSES_PER_GPU="2" crpi-h3snc261q1dosroc.cn-hangzhou.personal.cr.aliyuncs.com/marker11/marker_images:v0.2
```

### 2. Update FastGPT Configuration

```json
{
  xxx
  "systemEnv": {
    xxx
    "customPdfParse": {
      "url": "http://xxxx.com/v2/parse/file", // Custom PDF parsing service URL (marker v0.2)
      "key": "", // Custom PDF parsing service key
      "doc2xKey": "", // doc2x service key
      "price": 0 // PDF parsing service price
    }
  }
}
```

Restart the service after making changes.

### 3. Test It Out

Upload a PDF file to your knowledge base and check the `Enhanced PDF Parsing` option.

![alt text](/imgs/marker2.png)

After confirming the upload, you should see logs like this (LOG_LEVEL needs to be set to info or debug):

```
[Info] 2024-12-05 15:04:42 Parsing files from an external service
[Info] 2024-12-05 15:07:08 Custom file parsing is complete, time: 1316ms
```

You'll notice that PDFs parsed through Marker include image links:

![alt text](/imgs/image-10.png)

Similarly, in your app, you can check the `Enhanced PDF Parsing` option in the file upload configuration.

![alt text](/imgs/marker3.png)

## Results

Using Tsinghua's [ChatDev Communicative Agents for Software Develop.pdf](https://arxiv.org/abs/2307.07924) as an example, here's what Marker parsing looks like:

|                                 |                                 |                                 |
| ------------------------------- | ------------------------------- | ------------------------------- |
| ![alt text](/imgs/image-11.png) | ![alt text](/imgs/image-12.png) | ![alt text](/imgs/image-13.png) |
| ![alt text](/imgs/image-14.png) | ![alt text](/imgs/image-15.png) | ![alt text](/imgs/image-16.png) |

Top row shows chunked results, bottom row shows the original PDF. Images, formulas, and tables are all extracted successfully â€” the results are solid.

Note that [Marker](https://github.com/VikParuchuri/marker) is licensed under `GPL-3.0 license`. Please use it in compliance with the license terms.

## Legacy Marker Usage

For FastGPT versions before v4.9.0, you can use Marker parsing service this way:

Install and run Marker service:

```dockerfile
docker pull crpi-h3snc261q1dosroc.cn-hangzhou.personal.cr.aliyuncs.com/marker11/marker_images:v0.1
docker run --gpus all -itd -p 7231:7231 --name model_pdf_v1 -e PROCESSES_PER_GPU="2" crpi-h3snc261q1dosroc.cn-hangzhou.personal.cr.aliyuncs.com/marker11/marker_images:v0.1
```

And update FastGPT environment variables:

```
CUSTOM_READ_FILE_URL=http://xxxx.com/v1/parse/file
CUSTOM_READ_FILE_EXTENSION=pdf
```

- CUSTOM_READ_FILE_URL - Custom parsing service URL. Change host to your parsing service address, but keep the path unchanged.
- CUSTOM_READ_FILE_EXTENSION - Supported file extensions. Multiple types can be separated by commas.
