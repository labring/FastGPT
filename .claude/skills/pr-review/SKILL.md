---
name: pr-review
description: è¿›è¡Œ Pull Request ä»£ç å®¡æŸ¥,åŒ…æ‹¬ä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æ€§èƒ½ã€æ¶æ„åˆç†æ€§ç­‰æ–¹é¢çš„å…¨é¢è¯„ä¼°ã€‚å½“ç”¨æˆ·è¦æ±‚å®¡æŸ¥ PR æˆ–æåˆ° "review pr"ã€"æ£€æŸ¥ PR" ç­‰å…³é”®è¯æ—¶æ¿€æ´»ã€‚
---

# PR Review ä»£ç å®¡æŸ¥æŠ€èƒ½

> å…¨é¢å®¡æŸ¥ Pull Request çš„ä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æ€§èƒ½å’Œæ¶æ„è®¾è®¡,æä¾›ä¸“ä¸šçš„æ”¹è¿›å»ºè®®

## å¿«é€Ÿå¼€å§‹

```bash
# å®¡æŸ¥å½“å‰åˆ†æ”¯çš„ PR
gh pr view

# å®¡æŸ¥æŒ‡å®š PR
gh pr view 6324

# æŸ¥çœ‹å˜æ›´å†…å®¹
gh pr diff 6324
```

## å·¥å…·é›†æˆ

### ä½¿ç”¨ gh CLI åŠ é€Ÿå®¡æŸ¥

```bash
# æŸ¥çœ‹å¹¶å®¡æŸ¥ PR
gh pr view <number> && gh pr diff <number>

# æ·»åŠ å®¡æŸ¥è¯„è®º
gh pr review <number> --comment -b "æˆ‘çš„å®¡æŸ¥æ„è§"

# æ‰¹å‡† PR
gh pr review <number> --approve

# è¯·æ±‚ä¿®æ”¹
gh pr review <number> --request-changes
```

### æœ¬åœ°æµ‹è¯• PR

```bash
# æ£€å‡º PR åˆ†æ”¯åˆ°æœ¬åœ°
gh pr checkout <number>

# è¿è¡Œæµ‹è¯•
pnpm test

# è¿è¡Œ lint
pnpm lint

# ç±»å‹æ£€æŸ¥
pnpm tsc --noEmit

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨éªŒè¯
pnpm dev
```




### å¸¸è§å‘½ä»¤å‚è€ƒ

```bash
# PR ä¿¡æ¯æŸ¥çœ‹
gh pr view --json title,body,author,state,files,additions,deletions

# PR diff æŸ¥çœ‹
gh pr diff
gh pr diff <number> > /tmp/pr.diff  # ä¿å­˜åˆ°æ–‡ä»¶

# PR commits æŸ¥çœ‹
gh pr view --json commits --jq '.commits[].messageHeadline'

# PR checks çŠ¶æ€
gh pr checks

# PR è¯„è®º
gh pr comment <number> --body "è¯„è®ºå†…å®¹"

# PR å®¡æŸ¥æäº¤
gh pr review <number> --approve
gh pr review <number> --request-changes
gh pr review <number> --comment -b "è¯„è®ºå†…å®¹"

# PR æ“ä½œ
gh pr merge <number> --squash  # Squash merge
gh pr close <number>           # å…³é—­ PR
```

## å®¡æŸ¥æµç¨‹

### 1. ä¿¡æ¯æ”¶é›†é˜¶æ®µ

è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:

```bash
# 1. è·å– PR åŸºæœ¬ä¿¡æ¯
gh pr view --json title,body,author,state,headRefName,baseRefName,additions,deletions,files

# 2. è·å– PR å˜æ›´ diff
gh pr diff

# 3. è·å– PR çš„ commit å†å²
gh pr view --json commits

# 4. æ£€æŸ¥ CI/CD çŠ¶æ€
gh pr checks
```

### 2. å¤šç»´åº¦ä»£ç å®¡æŸ¥

æŒ‰ç…§ä»¥ä¸‹ä¸‰ä¸ªç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§å®¡æŸ¥:

#### ç»´åº¦ 1: ä»£ç è´¨é‡æ ‡å‡† ğŸ“

é€šç”¨çš„ä»£ç è´¨é‡æ ‡å‡†,é€‚ç”¨äºæ‰€æœ‰é¡¹ç›®:

- **å®‰å…¨æ€§**: è¾“å…¥éªŒè¯ã€æƒé™æ£€æŸ¥ã€æ³¨å…¥é˜²æŠ¤ã€æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- **æ­£ç¡®æ€§**: é”™è¯¯å¤„ç†ã€è¾¹ç•Œæ¡ä»¶ã€ç±»å‹å®‰å…¨
- **æ€§èƒ½**: ç®—æ³•å¤æ‚åº¦ã€æ•°æ®åº“ä¼˜åŒ–ã€å†…å­˜ç®¡ç†
- **å¯æµ‹è¯•æ€§**: æµ‹è¯•è¦†ç›–ã€æµ‹è¯•è´¨é‡ã€Mock ä½¿ç”¨

ğŸ“– **è¯¦ç»†æŒ‡å—**: [code-quality-standards.md](./code-quality-standards.md)

#### ç»´åº¦ 2: FastGPT é£æ ¼è§„èŒƒ ğŸ¨

FastGPT é¡¹ç›®ç‰¹å®šçš„ä»£ç è§„èŒƒå’Œçº¦å®š:

- **å·¥ä½œæµèŠ‚ç‚¹å¼€å‘**: ç±»å‹å®šä¹‰ã€èŠ‚ç‚¹æšä¸¾ã€æ‰§è¡Œé€»è¾‘ã€isEntry ç®¡ç†
- **API è·¯ç”±å¼€å‘**: è·¯ç”±å®šä¹‰ã€æƒé™éªŒè¯ã€é”™è¯¯å¤„ç†
- **å‰ç«¯ç»„ä»¶å¼€å‘**: TypeScript + Reactã€Chakra UIã€çŠ¶æ€ç®¡ç†
- **æ•°æ®åº“æ“ä½œ**: Model å®šä¹‰ã€æŸ¥è¯¢ä¼˜åŒ–ã€ç´¢å¼•è®¾è®¡
- **åŒ…ç»“æ„ä¸ä¾èµ–**: ä¾èµ–æ–¹å‘ã€å¯¼å…¥è§„èŒƒã€ç±»å‹å¯¼å‡º

ğŸ“– **è¯¦ç»†æŒ‡å—**: [fastgpt-style-guide.md](./fastgpt-style-guide.md)

#### ç»´åº¦ 3: å¸¸è§é—®é¢˜æ£€æŸ¥æ¸…å• ğŸ”

å¿«é€Ÿè¯†åˆ«å’Œä¿®å¤å¸¸è§é—®é¢˜æ¨¡å¼:

- **TypeScript é—®é¢˜**: any ç±»å‹æ»¥ç”¨ã€ç±»å‹å®šä¹‰ä¸å®Œæ•´ã€ä¸å®‰å…¨æ–­è¨€
- **å¼‚æ­¥é”™è¯¯å¤„ç†**: æœªå¤„ç† Promiseã€é”™è¯¯ä¿¡æ¯ä¸¢å¤±ã€é™é»˜å¤±è´¥
- **React æ€§èƒ½**: ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€æ¸²æŸ“ä¸­åˆ›å»ºå¯¹è±¡ã€ç¼ºå°‘ memoization
- **å·¥ä½œæµèŠ‚ç‚¹**: isEntry æœªé‡ç½®ã€äº¤äº’å†å²æœªæ¸…ç†ã€ç™½åå•é—æ¼
- **å®‰å…¨æ¼æ´**: æ³¨å…¥æ”»å‡»ã€XSSã€æ–‡ä»¶ä¸Šä¼ æ¼æ´

ğŸ“– **è¯¦ç»†æ¸…å•**: [common-issues-checklist.md](./common-issues-checklist.md)

### 3. ç”Ÿæˆå¹¶æäº¤å®¡æŸ¥æŠ¥å‘Š

PR å®¡æŸ¥è¾“å‡ºåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:
1. **æ•´ä½“å®¡æŸ¥æŠ¥å‘Š**: æäº¤ä¸º PR é¡¶éƒ¨çš„æ€»ä½“è¯„è®º
2. **è¡Œçº§ä»£ç è¯„è®º**: ç›´æ¥åœ¨ä»£ç è¡Œçš„ä½ç½®æ·»åŠ å…·ä½“è¯„è®º

#### æ­¥éª¤ 1: åˆ†æä»£ç å¹¶å‡†å¤‡è¯„è®º

åœ¨å®¡æŸ¥è¿‡ç¨‹ä¸­,éœ€è¦ä¸ºæ¯ä¸ªé—®é¢˜è®°å½•:
- **æ–‡ä»¶è·¯å¾„**: å¦‚ `packages/service/core/workflow/dispatch.ts`
- **è¡Œå·**: å¦‚ `L142-L150`
- **é—®é¢˜ç±»å‹**: ğŸ”´ä¸¥é‡ / ğŸŸ¡æ”¹è¿› / ğŸŸ¢ä¼˜åŒ–
- **è¯„è®ºå†…å®¹**: å…·ä½“çš„é—®é¢˜æè¿°å’Œå»ºè®®


#### æ­¥éª¤ 2: æ·»åŠ è¡Œçº§ä»£ç è¯„è®º

GitHub CLI æ”¯æŒåœ¨ç‰¹å®šè¡Œæ·»åŠ è¯„è®ºã€‚è¯„è®ºæ•°æ®æ ¼å¼ä¸º JSON:

```bash
# 1. å‡†å¤‡è¡Œçº§è¯„è®º JSON æ–‡ä»¶
cat > /tmp/line-comments.json << 'EOF'
{
  "body": "è¡Œçº§ä»£ç å®¡æŸ¥è¯„è®º",
  "event": "COMMENT",
  "comments": [
    {
      "path": "packages/service/core/workflow/dispatch.ts",
      "line": 142,
      "body": "ğŸ”´ **ä¸¥é‡é—®é¢˜**: è¿™é‡Œç¼ºå°‘é”™è¯¯å¤„ç†,å¦‚æœ runtimeNode ä¸º null ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚\n\n**å»ºè®®**:\n```typescript\nif (!runtimeNode) {\n  throw new Error(`Runtime node not found: ${nodeId}`);\n}\n```"
    },
    {
      "path": "packages/service/core/workflow/dispatch.ts",
      "line": 150,
      "body": "ğŸŸ¡ **æ€§èƒ½ä¼˜åŒ–**: å»ºè®®å°†æ­¤æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æå–åˆ°å‡½æ•°å¤–éƒ¨,é¿å…æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°ç¼–è¯‘ã€‚\n\n**å»ºè®®**:\n```typescript\nconst NODE_ID_PATTERN = /^node_([a-f0-9]+)$/; // åœ¨æ¨¡å—é¡¶éƒ¨å®šä¹‰\n```"
    }
  ]
}
EOF

# 2. æäº¤æ•´ä½“å®¡æŸ¥æŠ¥å‘Šå’Œè¡Œçº§è¯„è®º
gh pr review <number> --body-file /tmp/pr-review.md --json > /tmp/review-result.json
```

#### æ­¥éª¤ 3: ç”Ÿæˆæ•´ä½“å®¡æŸ¥æŠ¥å‘Š

```markdown
# PR Review: {PR Title}

## ğŸ“Š å˜æ›´æ¦‚è§ˆ
- **PR ç¼–å·**: #{number}
- **ä½œè€…**: @author
- **åˆ†æ”¯**: {baseRefName} â† {headRefName}
- **å˜æ›´ç»Ÿè®¡**: +{additions} -{deletions} è¡Œ
- **æ¶‰åŠæ–‡ä»¶**: {files.length} ä¸ªæ–‡ä»¶

## âœ… ä¼˜ç‚¹
{åˆ—å‡ºåšå¾—å¥½çš„åœ°æ–¹}

## âš ï¸ é—®é¢˜æ±‡æ€»

### ğŸ”´ ä¸¥é‡é—®é¢˜ ({count} ä¸ª,å¿…é¡»ä¿®å¤)
{ç®€è¦åˆ—å‡ºæ¯ä¸ªä¸¥é‡é—®é¢˜,å¹¶åœ¨ä¸‹æ–¹æ·»åŠ è¡Œçº§è¯„è®º}

### ğŸŸ¡ å»ºè®®æ”¹è¿› ({count} ä¸ª)
{ç®€è¦åˆ—å‡ºæ¯ä¸ªå»ºè®®}

### ğŸŸ¢ å¯é€‰ä¼˜åŒ– ({count} ä¸ª)
{ç®€è¦åˆ—å‡ºä¼˜åŒ–å»ºè®®}

## ğŸ§ª æµ‹è¯•å»ºè®®
{å»ºè®®çš„æµ‹è¯•æ–¹æ³•}

## ğŸ’¬ æ€»ä½“è¯„ä»·
- **ä»£ç è´¨é‡**: â­â­â­â­â˜† (4/5)
- **å®‰å…¨æ€§**: â­â­â­â­â­ (5/5)
- **æ€§èƒ½**: â­â­â­â­â˜† (4/5)
- **å¯ç»´æŠ¤æ€§**: â­â­â­â­â˜† (4/5)

## ğŸš€ å®¡æŸ¥ç»“è®º
{å»ºè®®: é€šè¿‡/éœ€ä¿®æ”¹/æ‹’ç»}

---

## ğŸ“ è¯¦ç»†ä»£ç è¯„è®º
å·²åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ äº†å…·ä½“çš„è¡Œçº§è¯„è®º:
{åˆ—å‡ºæ‰€æœ‰æ·»åŠ äº†è¡Œçº§è¯„è®ºçš„ä½ç½®}
```

#### æ­¥éª¤ 4: æäº¤æ•´ä½“å®¡æŸ¥æŠ¥å‘Š

é€šè¿‡ GitHub CLI æäº¤æ•´ä½“å®¡æŸ¥æŠ¥å‘Šåˆ°è¯„è®ºåŒºã€‚

#### å®¡æŸ¥å‘½ä»¤å¿«é€Ÿå‚è€ƒ:

| åœºæ™¯ | å‘½ä»¤ |
|------|------|
| æ‰¹å‡† PR | `gh pr review <number> --approve` |
| è¯·æ±‚ä¿®æ”¹ | `gh pr review <number> --request-changes` |
| ä¸€èˆ¬è¯„è®º | `gh pr review <number> --comment` |
| ä»æ–‡ä»¶æäº¤ | `gh pr review <number> --body-file /tmp/review.md` |
| æ·»åŠ æ™®é€šè¯„è®º | `gh pr comment <number> --body "å†…å®¹"` |
| æ’¤é”€å®¡æŸ¥ | `gh pr review <number> --dismiss` |


## å‚è€ƒæ–‡æ¡£

### æ ¸å¿ƒå®¡æŸ¥æ–‡æ¡£
- **ç»´åº¦ 1**: [code-quality-standards.md](./code-quality-standards.md) - é€šç”¨ä»£ç è´¨é‡æ ‡å‡†
- **ç»´åº¦ 2**: [fastgpt-style-guide.md](./fastgpt-style-guide.md) - FastGPT é¡¹ç›®è§„èŒƒ
- **ç»´åº¦ 3**: [common-issues-checklist.md](./common-issues-checklist.md) - å¸¸è§é—®é¢˜æ¸…å•
