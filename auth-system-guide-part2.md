## 工作原理详解

### 认证流程

1. 用户访问分享链接（端口3004）
2. 认证代理服务检查请求中是否包含有效的token
3. 如果没有token，重定向到登录页面，并在URL中加入原始URL作为redirect参数
4. 用户登录或注册账号
5. 登录成功后，系统将token添加到原始URL中，并重定向回分享页面
6. 认证代理服务验证token有效，然后将请求代理到FastGPT
7. FastGPT处理请求并返回结果
8. 认证代理服务将结果返回给用户

### 监控记录流程

1. 用户在分享页面与AI对话
2. 对话请求通过认证代理服务
3. 代理服务记录问题和回答
4. 同时，FastGPT端的集成模块也会将对话发送到监控系统
5. 管理员可以在管理后台查看所有对话记录

## 常见问题与解决方案

### 1. 服务无法启动

**问题**: 尝试启动服务时出现EADDRINUSE错误

**解决方案**:
```powershell
# 找出并结束占用端口的进程
Get-Process | Where-Object { $_.ProcessName -eq "node" } | Stop-Process -Force
```

### 2. 登录后无法重定向回分享页面

**问题**: 登录成功但没有跳转回原始页面

**解决方案**:
- 检查login.html中的重定向逻辑
- 确保URL参数正确传递
- 检查浏览器控制台是否有错误

### 3. 对话记录未显示在管理后台

**问题**: 对话进行了但管理后台看不到记录

**解决方案**:
- 检查fixed-proxy.js中的记录逻辑
- 确保auth-proxy/index.js中的logChatToAuthSystem函数被正确调用
- 检查API请求是否成功（查看网络请求）

## 安全注意事项

1. 默认的管理员账号（admin/123456）仅用于测试，生产环境请修改为复杂密码
2. 当前实现使用内存存储数据，系统重启后数据会丢失，生产环境请使用数据库
3. Token实现采用简单方式，生产环境建议使用JWT并添加过期时间
4. 分享链接的认证仅对通过3004端口访问的请求有效，直接访问3000端口仍可绕过认证

## 结语

本认证监管系统为FastGPT提供了基本的用户认证和对话监控功能。您可以根据需求进一步扩展和完善系统，例如：

- 集成真实数据库（MongoDB、MySQL等）
- 添加更多管理功能（数据分析、风险监控等）
- 完善用户管理（角色权限、审核机制等）
- 增强安全性（HTTPS、API权限等）

通过本指南，您应该能够成功部署和使用FastGPT认证监管系统，并根据需要进行定制和修改。